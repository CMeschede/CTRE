---
output:
  md_document:
    variant: markdown_github
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# CTRM

## Install from GitHub

Run 

```{r, eval=FALSE}
# install.packages("devtools")
devtools::install_github("strakaps/CTRM")
```


## Example

Run `foo.R` line by line.


## TODO

- [ ] Write method that outputs MLestimates and GPestimates
- [ ] empirical copula for the check of independence assumption
- [ ] estimate parameters automatically 
- [ ] quality of fits
- [ ] acf plot to check i.i.d. assumption
- [ ] output a new instance of simulated mrp based on the estimated
      parameters
- [x] add data
- [ ] add shiny function
- [ ] allow for input of class 'zoo' and 'irts'
- [ ] Maximum Likelihood estimators for Mittag-Leffler distribution


## The Datasets

```{r}
# ctrm_data <- flares
ctrm_data <- seaquakes
```


Magnitudes of the ctrm_data, static qqplot:

```{r}
ctrm_data %>% ctrm() %>% thin(k = 300) %>% coredata() %>% qqestplot(static = TRUE)
```

Magnitudes of ctrm_data, dynamic qqplot:

```{r}
ctrm_data %>% ctrm() %>% thin(k = 500) %>% coredata() %>% qqestplot(static = FALSE)
```


Threshold crossing times of ctrm_data, static qqplot:

```{r}
ctrm_data %>% ctrm() %>% thin(k = 500) %>% time() %>% diff() %>% as.vector() %>% 
  qqestplot(static = TRUE, ylim = c(2,10), log = 'xy')
```

Compare the above with a static qqplot for Mittag-Leffler random variables: 

```{r}
MittagLeffleR::rml(n = 1000, tail = 0.9) %>% qqestplot(static=TRUE, ylim=c(-4,4))
```

The fit looks almost equally bad. Compare with the 'fit' of an exponential distribution: 
```{r}
rexp(1000) %>% qqestplot(static = TRUE, ylim = c(-6,2))
```

It should be clear that the qqplot estimator is unsuitable to assess the 
tail exponent of a Mittag-Leffler distribution. For the same reason, the 
Hill estimator is unsuitable for the Mittag-Leffler distribution. 


How is the Mittag-Leffler log-moment estimator doing on exponential data?

```{r}
MittagLeffleR::logMomentEstimator(rexp(500))
```

Let's look at Mittag-Leffler QQ plots: 

```{r}
ctrm_data %>% ctrm() %>% thin(k=200) %>% interarrival() %>%
  mlqqplot(tail = 1, asp = 1, log = 'xy')
```


Compare this with a Mittag-Leffler QQ plot for an exponential distribution: 

```{r}
rexp(100) %>% mlqqplot(tail = 0.8, log = 'xy')
```



